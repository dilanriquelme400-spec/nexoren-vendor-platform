<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nexoren — Admin Sellers</title>
  <style>
    :root{
      --nx-primary:#5B2EFF;
      --nx-bg:#0F0F14;
      --nx-text:#F5F5F7;
      --nx-muted:rgba(245,245,247,.72);
      --nx-card:#11111A;
      --nx-border:#232338;
      --nx-shadow:0 18px 60px rgba(0,0,0,.55);
      --nx-danger:#ff4d6d;
      --nx-success:#2ecc71;
    }
    body{margin:0;background:linear-gradient(180deg,var(--nx-bg),#0b0b10);color:var(--nx-text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;}
    .wrap{max-width:1100px;margin:0 auto;padding:32px 16px;}
    .card{background:rgba(17,17,26,.92);border:1px solid var(--nx-border);border-radius:18px;box-shadow:var(--nx-shadow);overflow:hidden}
    header{padding:22px 22px 10px}
    h1{margin:0 0 6px;font-size:26px;letter-spacing:-.02em}
    p{margin:0;color:var(--nx-muted);font-size:13px;line-height:1.5}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;padding:14px 22px 22px}
    .input{flex:1;min-width:260px;background:#141420;border:1px solid var(--nx-border);color:var(--nx-text);border-radius:12px;padding:12px}
    .btn{border-radius:12px;padding:12px 14px;border:1px solid var(--nx-border);cursor:pointer;font-weight:800;background:transparent;color:var(--nx-text)}
    .btn.primary{background:var(--nx-primary);border-color:rgba(91,46,255,.65)}
    .btn.ghost:hover{background:rgba(245,245,247,.06)}
    .pill{font-size:12px;padding:6px 10px;border-radius:999px;border:1px solid var(--nx-border);color:var(--nx-muted)}
    .ok{color:var(--nx-success)}
    .bad{color:var(--nx-danger)}
    .tableWrap{padding:0 22px 22px}
    table{width:100%;border-collapse:separate;border-spacing:0 10px}
    th{font-size:12px;color:var(--nx-muted);text-align:left;padding:0 10px}
    td{background:rgba(20,20,32,.6);border:1px solid var(--nx-border);padding:12px 10px;font-size:13px}
    tr td:first-child{border-radius:12px 0 0 12px}
    tr td:last-child{border-radius:0 12px 12px 0}
    .actions{display:flex;gap:8px}
    .mini{padding:9px 10px;border-radius:10px}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <h1>Admin — Seller Applications</h1>
        <p>Pega tu <b>ADMIN_TOKEN</b> para ver y aprobar/rechazar solicitudes.</p>
      </header>

      <div class="row">
        <input id="token" class="input" placeholder="ADMIN_TOKEN..." />
        <button class="btn primary" id="save">Entrar</button>
        <button class="btn ghost" id="clear">Salir</button>
        <span class="pill" id="status">No autenticado</span>
      </div>

      <div class="row" style="padding-top:0">
        <button class="btn ghost mini" id="reload">Actualizar lista</button>
        <select id="filter" class="input" style="max-width:220px">
          <option value="">Todos</option>
          <option value="pending">Pendientes</option>
          <option value="approved">Aprobados</option>
          <option value="rejected">Rechazados</option>
        </select>
      </div>

      <div class="tableWrap">
        <table>
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Tienda</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="rows">
            <tr><td colspan="6" style="border-radius:12px;">Sin datos</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

<script>
  const els = {
    token: document.getElementById("token"),
    save: document.getElementById("save"),
    clear: document.getElementById("clear"),
    reload: document.getElementById("reload"),
    filter: document.getElementById("filter"),
    status: document.getElementById("status"),
    rows: document.getElementById("rows"),
  };

  function setStatus(ok, text){
    els.status.textContent = text;
    els.status.className = "pill " + (ok ? "ok" : "bad");
  }

  function getToken(){
    return (localStorage.getItem("nx_admin_token") || "").trim();
  }

  function setToken(t){
    localStorage.setItem("nx_admin_token", t);
  }

  function clearToken(){
    localStorage.removeItem("nx_admin_token");
  }

  async function api(path, opts={}){
    const t = getToken();
    const headers = Object.assign({}, opts.headers || {});
    if(t) headers["x-admin-token"] = t;
    const res = await fetch(path, { ...opts, headers });
    const data = await res.json().catch(()=> ({}));
    if(!res.ok) throw data;
    return data;
  }

  function esc(s){ return String(s || "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function render(rows){
    if(!rows || !rows.length){
      els.rows.innerHTML = `<tr><td colspan="6" style="border-radius:12px;">Sin solicitudes</td></tr>`;
      return;
    }
    els.rows.innerHTML = rows.map(r => {
      const date = r.createdAt ? new Date(r.createdAt).toLocaleString() : "-";
      const status = r.status || "pending";
      return `
        <tr>
          <td>${esc(date)}</td>
          <td>${esc(r.fullName)}</td>
          <td>${esc(r.email)}</td>
          <td>${esc(r.storeName)}</td>
          <td>${esc(status)}</td>
          <td>
            <div class="actions">
              <button class="btn ghost mini" data-view="${r._id}">Ver</button>
              <button class="btn mini" style="border-color:rgba(46,204,113,.35)" data-approve="${r._id}">Aprobar</button>
              <button class="btn mini" style="border-color:rgba(255,77,109,.35)" data-reject="${r._id}">Rechazar</button>
            </div>
          </td>
        </tr>
      `;
    }).join("");

    // actions
    els.rows.querySelectorAll("[data-approve]").forEach(b => b.onclick = () => approve(b.dataset.approve));
    els.rows.querySelectorAll("[data-reject]").forEach(b => b.onclick = () => reject(b.dataset.reject));
    els.rows.querySelectorAll("[data-view]").forEach(b => b.onclick = () => view(b.dataset.view, rows));
  }

  async function load(){
    const t = getToken();
    if(!t){
      setStatus(false, "No autenticado");
      render([]);
      return;
    }
    setStatus(true, "Autenticado");
    const status = els.filter.value;
    const qs = status ? `?status=${encodeURIComponent(status)}` : "";
    const data = await api(`/admin/sellers${qs}`);
    render(data.rows || []);
  }

  async function approve(id){
    await api(`/admin/sellers/${id}/approve`, { method:"POST" });
    await load();
  }
  async function reject(id){
    await api(`/admin/sellers/${id}/reject`, { method:"POST" });
    await load();
  }

  function view(id, rows){
    const r = rows.find(x => x._id === id);
    if(!r) return;
    alert(
      `Solicitud\n\n` +
      `Nombre: ${r.fullName}\nEmail: ${r.email}\nTienda: ${r.storeName}\nEstado: ${r.status}\n\n` +
      `ID Front: ${r.idFrontUrl || "-"}\n` +
      `ID Back: ${r.idBackUrl || "-"}\n` +
      `Selfie: ${r.selfieUrl || "-"}\n`
    );
  }

  els.save.onclick = async () => {
    const t = els.token.value.trim();
    if(!t) return;
    setToken(t);
    await load().catch(err => {
      setStatus(false, "Token inválido");
      console.log("admin error:", err);
    });
  };

  els.clear.onclick = () => {
    clearToken();
    els.token.value = "";
    setStatus(false, "No autenticado");
    render([]);
  };

  els.reload.onclick = () => load().catch(err => console.log(err));
  els.filter.onchange = () => load().catch(err => console.log(err));

  // init
  els.token.value = getToken();
  load().catch(err => {
    setStatus(false, "No autorizado");
    console.log(err);
  });
</script>
</body>
</html>
